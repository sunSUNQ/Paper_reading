# Towards the Detection of Inconsistencies in Public Security Vulnerability Reports

> 2019年usenix，Ying Dong中国科学院大学（宾夕法尼亚大学）

## 摘要

虽然NVD和CVE两个网站对于漏洞的管理以及披露在领域内非常权威并且影响很大，但是漏洞信息的错误标注以及混淆信息也很多，越来越被人们关注。

本文提出的**VIEW（Vulnerability Information Extraction Model）自动化系统**可以**检测非结构化的CVE以及结构化的NVD以及其他网站的漏洞信息不一致性**。VIEW首次提供了对于大规模化的信息进行一致性分析的平台，同时还为及时更新CVE/NVD数据库信息提供了工具。VIEW主要的目的就是从不规则的信息中提取到漏洞所在的软件名以及软件版本信息。引入了基于深度学习的命名实体识别（NER）以及关系提取（RE），以便于可以识别出不可见的软件名称，还有基于句子结构以及内容提取出来的版本信息。在实际的应用上进行实验，结果表示VIEW效果很好，0.941的精度以及0.993的召回率。使用过去20年间的78296个CVE以及70569个NVD的漏洞报告作为数据集，结果证明只有59.82%的CVE报告可以对应上NVD的报告，并且随着时间的增长不一致性增加。证明了错误的信息或多或少的都会对软件版本进行误报，多报版本或者少报。

## 介绍（第一章和第二章）

未修复的漏洞如wannacry会造成严重的影响。现在已有强大的社区团体来挖掘漏洞，意在优先于恶意攻击者发现漏洞。CVE和NVD就是两个最具影响力的漏洞库。他们都在指导缓解漏洞带来的危害中起到了很大的效果。随着漏洞信息量的增加，对于信息质量的关注也越来越多，NVD和CVE上的漏洞信息缺乏更新并且有很多不正确的信息存在。因此，提出的VIEW就是一个很有必要的存在，可以大规模的扫描漏洞信息，然后进行规范化整理，并且主要关注在漏洞版本信息上。

### 主要面临的挑战：

1. 特别多的程序名以及版本信息，如何建立基础库进行判断，如何提高准确率，出现新的软件名如何处理。

2. 非结构化的漏洞信息描述通常包含代码以及描述方法差异性大，已有的工具不能很好的处理信息。

3. 需要提取含有漏洞的软件名以及版本、也要提取出没有漏洞的版本和软件标识信息。

   ![1571793727188](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571793727188.png)

4. 漏洞报告中的信息包含多个实体，需要可以同时处理多个实体并找到关键部分

5. 漏洞类型多种多样，不能简单的根据每一种漏洞来进行识别，需要可以处理不同种类漏洞的能力。

### VIEW关键点介绍：

VIEW使用的NER是一个递归的深度神经网络，可以精确地找到相关实体。利用单词和字符嵌入来编码文本，利用序列到序列的双向GRU（门控循环单元）来定位易受攻击的软件名称以及版本。利用RE模型进行训练，用来分析提取实体间的关系，为了将易受攻击的软件名称以及版本信息对应到一起。最后为了使模型可以处理更多类型的漏洞，引入了转移学习的步骤，可以最大限度的减少手动注释工作。

### 实验和评估：

找了过去20年的78296个CVE ID以及70569个漏洞报告，涵盖了十三种漏洞类型。手动分析了5193个CVE并进行了标注。实验结果：0.941的精确率、0.993的召回率，可以推广到13种漏洞类型中。

将NVD的信息作为标准（因为是信息流的最后一跳）。首先就是信息的不一致性很高，只有59.82%的外部报告/CVE摘要具有与NVD标注相同的版本，“overclain”和“underclain”的情况都很多。并对实验结果进行了人工的确认。

### 主要贡献：

1. 设计并开发了VIEW，可以从非结构化的漏洞报告中提取漏洞软件名称以及版本信息。
2. 使用大量真实的数据集证明可以涵盖13种漏洞类型，并且实验效果很好。
3. 首次对大规模的漏洞信息进行处理，可以持续监视不同的漏洞报告网站，并定期的从CVE/NVD库中生成差异，差异有助于推动主动的漏洞测试以及信息管理。

### CVE与NVD

用了很大一段分别介绍CVE和NVD，这里不再描述，可以自行百度。主要想介绍一下文章提到的区别。

NVD相比于CVE来说，是CVE列表的一个扩充，也是一个整合，将CVE的条目进行格式化处理成xml或者json的格式，然后进行标准化。第二个特点就是会不断的更新，如果发现新的版本也会陆续的加入到NVD的描述中。（但此处的更新为手动更新）



## VIEW设计（第三章和第四章）

为了确定和识别我们需要的实体信息，主要设计了三个单独的任务：命名实体识别模型、关系提取模型、转移学习。

![1571799681936](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571799681936.png)

### 命名实体识别模型（NER）

![1571794171698](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571794171698.png)

需要识别的实体有脆弱的组件、脆弱的软件、依赖的系统等。NER可以根据输入的文本结构以及语义精确的定位实体：定位到隐式的软件名、有漏洞与无漏洞版本的上下文区别。

使用最新的NER模型，然后加入了gazetteer（地名词典）用来提高识别软件名称的准确性。将单词和字符嵌入的串联将文本序列编码为单词向量序列。然后将单词向量序列作为模型输入，使用双向递归神经网络为序列中每一个单词预测一个标签。

![1571797435183](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571797435183.png)

先将单词和字符使用标准嵌入方法编码为矢量表示，进行串联为一个向量序列。然后利用双向门控循环联合（Bi-GRU）网络进行标签分配。标签分为：SV（软件版本）、SN（软件名称）、O（其他）。SN标签实体：脆弱的软件名称、脆弱的软件组件、依赖的系统。因为软件名称可能包含组件和系统。

gazetteer（地名词典）就是cve的product list（81551个软件名）。如果在提取漏洞信息时至少从gazetteer中识别并标注了一个实体，则将其标注为软件名。这种工作可以纠正错误的标签，如Internet Explorer。

### 关系提取模型（RE）

问题：提取到实体以后，下一步就是对提取出来的实体进行关系匹配。正常的情况下是软件名和其版本信息离得近，可以对应上，但是很多都不适用这种情况。

![1571795461666](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571795461666.png)

解决办法：首先检查所有可能的实体之间的组合，利用RE来确定最有可能的组合。

The Microsoft VBScript 5.7 and 5.8 engines , as used in Internet Explorer 9 through 11 …

实体有Microsoft VBScript和Internet Explorer两个，版本有5.7 and 5.8、9 through 11两个范围，可以组成四种实体间的关系。使用RE对每个组合分配一个二进制属性。然后VIEW根据二进制属性来判断实体之间的关系哪个为正确的。

使用的是Common Platform Enumeration (CPE) 格式来存贮最终的得出的关系。

cpe:/a:google:chrome:3.0.193.2:beta

google表示供应商、chrome表示软件名、3.0.193.2表示版本、beta表示软件更新

![1571799942070](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571799942070.png)

 hierarchical attention neural networks（分层注意力神经网络），在单词级别和句子级别实现了一个注意力网络。首先提取出来所有的实体之间的关系对，进行编码，产生一组位置嵌入（position embedding）代表从当前单词到两个命名实体的相对距离（step 1）。将位置向量嵌入到单词嵌入向量中形成每个实体间关系的向量表示（step 2），然后作为注意力神经网络的输入，输出的结果就是判断的实体间关系（step 3）。

### 数据集

**CVE ID**：找了过去20年的78296个CVE ID，涵盖了十三种漏洞类型。虽然CVE网站声称他们有105000个CVE 但是由于部分没有公开还有一部分被合并或者撤回，针对十三种漏洞类型找到了78296个CVE。

![1571815356519](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571815356519.png)

**漏洞报告**：在CVE关联的漏洞相关源网站中主要选择五个：ExploitDB，SecurityFocus，SecurityTracker， Openwall and SecurityFocus Forum 。从中找到70569个与56642个cve相关的漏洞报告，占总CVE的72.34%，说明这些网站受欢迎程度高。分为来自ExploitDB、Openwall 、SecurityFocus Forum 的24757条非结构化报告以及SecurityFocus、SecurityTracker的45812条结构化报告。

![1571802050869](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571802050869.png)

**数据提取与处理**：对于结构化报告，按照固定格式直接解析提取软件名称以及版本信息；对于非结构化报告，使用NLTK工具提取文本信息，删除所有WEB链接并标记句子。

**真实数据集**：手动注释。5193个CVE 以及1974个非结构化报告。未使用结构化报告作为数据集的原因：结构化报告不一定准确、标记需要标签来表示实体间的关系，结构化报告不能提供。不是均匀的从13个类别中抽取，主要从内存破坏类找（3448），然后其他十二种各找一点（145）。手动注释中发现，软件名和版本都是出现在同一个句子中。

### 转移学习

想要涵盖更多种类的漏洞报告，就需要一个经过标注的测试集，但是没有现成的并且人工需要大量的工作不现实。因此用转移学习的方法来解决这种问题，用一个主要的分析策略来学习上述的NER和RE然后使用转移学习来迁移到其他种类的漏洞上。可以极大的减小漏洞标注人工的工作。





## 评估模型（第五章）

### NER模型评估：

评估指标：精度代表提取的实体中相关实体所占的比例（提取的实体中，属于软件名、软件组件、系统其中之一）；召回表示提取的相关实体在相关实体总数中所占比例（漏洞中标记了10个实体，提取出来多少个）；总体精确度表示正确的预测在所有的预测中所占的比例（标记的实体间关系，预测成功的实体间关系）。

用80%的数据集进行训练，10%的数据集进行验证，10%进行测试，并进行了十次不同的测试。单词嵌入维度为300、字符嵌入维度50、仅考虑每个句子前200个单词、批处理大小50、周期数20、随机梯度下降方法Adam作为优化、dropout来防止过拟合。

![1571815320601](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571815320601.png)

表中可以看到，实验效果很好，使用字典的方式确实可以提升一定的效果。并发现模型可以识别出训练测试集中不存在的软件名称。

### RE模型评估：

用80%的数据集进行训练，10%的数据集进行验证，10%进行测试，训练单词嵌入维数为50，位置嵌入为10，批处理大小80，周期数200，双向层数设置为2。

![1571815306787](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571815306787.png)

### 其他评估：

和semfuzz进行了比较，还实现了一个随机字段序列模型来提取实体的基准系统，都没有VIEW效果好。

并且验证参数不敏感，使用不同的参数跑出来的结果都很好，差异不大。

![1571815287723](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571815287723.png)

### 转移学习评估：

基于已有的模型然后进行转移学习的操作，针对不同的漏洞类型重新训练模型。对原来的内存破坏类漏洞模型的最后一层进行微调，然后进行训练和测试。

对于NER模型的影响不大，对于RE模型的影响较大，并且证明对于不同的漏洞种类需要不同的模型。

![1571815771117](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571815771117.png)

![1571815788804](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571815788804.png)

## 评估消息不一致性（第六章）

之前所有的实验都证明了VIEW可用，并且有很好的提取软件名以及版本并进行匹配的能力，接下来就是本文的主要目的，评估各个网站中对于漏洞信息报告的信息不一致性。

1. 定义评估标准来量化一致性
2. 对真实数据集进行初步测试，估计VIEW的测量误差
3. 完整数据集测试，以检查一致性级别在不同漏洞类型之间的变化

### 匹配软件名称

从NVD数据库中找到CVE对应的软件名称与版本形成列表C，从外部报告中也提取列表C`。然后尝试匹配，可以处理同一个软件名称不同的格式都默认为相同，匹配词数量大于或者等于不匹配词数量则视为匹配。“Microsoft Internet Explorer“和”Internet Explorer“默认为匹配。

### 测量版本一致性

- version 1.4 and earlier 
- <= 1.4 
- 1.0、1.1、1.2、1.3、1.4
- 然后进行匹配，严格匹配是指版本完全相同、松散匹配是指版本为另一个的子集。

### 真实数据集实验

![1571819201151](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571819201151.png)

实验表明对于内存损坏类的漏洞只有87%的是松散匹配，45%的是严格匹配。使用VIEW提取的跟人工标注的真实的数据集结果相差不大，可以说明模型的准确率。

### 使用完整数据集实验

78296个CVE中，提取了18764个软件名称，对应154569个软件名-版本元组，以及来自外部网站的235350个软件名-版本元组，一共有389476个可以检测一致性的元组对。

软件名-版本级别：发现78.32%个严格匹配、93.49%松散匹配。报告级别：59.82%严格匹配、90.05%松散匹配。

图10：CVE的效果较好，EDB的效果也很好，说明这个网站对应的消息很有借鉴作用。

图 9：NVD对于版本的标注信息有夸大和不准确的部分。

图11：松散匹配中的underclain和overclain的百分比

![1571828611570](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571828611570.png)

一些导致不匹配的原因：错别字的存在（0.8.6写成0.6.8、0.22更高版本写成0.2.2）、还有的问题是不同网站的漏洞报告版本信息差异特别大（3.9.4到3.9.5、0.30到0.92）

图12：NVD和其他六个信息源一致性级别随着时间的推移而降低。就是说明随着时间的推移，报告一致性在逐渐增强。

图13：比较CVE和其他五个信息源一致性，说明CVE在相比于其他信息源来说漏洞信息版本在越来越好。

图14：根据漏洞类别划分，松散匹配率大概相似，但是严格匹配率差异性较大，因为更复杂的漏洞类型进行报告的更新等操作更复杂，NVD容易错过一些版本更新。

![1571829039029](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571829039029.png)

## 案例分析（第七章）

对七个漏洞进行了实验，尝试复现不同版本下的漏洞，总共涵盖了47个漏洞报告，总计获取了185个软件版本，然后人工复现（4个月的时间）。ground truth表示真正有漏洞的版本。185个版本中确认64个版本有漏洞。新发现了12个有漏洞的版本，在NVD中没有提到。

![1571829430786](https://github.com/sunSUNQ/Paper_reading/raw/master/Towards%20the%20Detection%20of%20Inconsistencies%20in%20Public%20Security%20Vulnerability%20Reports/image/1571829430786.png)

## 结论

VIEW具备对结构化的NVD漏洞报告以及非结构化的其他网站漏洞报告的大规模分析能力。结果表明漏洞报告不一致性很普遍，低估和高估的现象很严重。

## 想法

在不同的网站上收集漏洞报告会好一点。提取多个信息源进行综合的分析。不管是人工还是自动化。

使用神经网络的方式来提取漏洞报告关键信息可行性，可以使用转移学习的方法将一个框架扩展到多个漏洞种类上。

VIEW工具的试用。

